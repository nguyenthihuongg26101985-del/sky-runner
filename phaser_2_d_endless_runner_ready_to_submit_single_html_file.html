<!--
Title: Sky Runner — simple 2D endless runner (Phaser 3)
Author: Trí + ChatGPT
How to run: just open this file (index.html) in Chrome. If you see a blank page due to local file security, start a tiny server (e.g., VS Code Live Server) — but most schools just open it directly.
How to submit: hand in this single file. No external assets needed.
Controls: SPACE / W / ↑ to jump, hold to jump higher. Mobile: tap.
-->
<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sky Runner — Phaser 3</title>
  <style>
    html, body { height: 100%; margin: 0; background:#0e1020; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    #game { display:flex; align-items:center; justify-content:center; height:100%; }
    .credit { position:fixed; right:10px; bottom:10px; color:#9aa3b2; font-size:12px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>
</head>
<body>
  <div id="game"></div>
  <div class="credit">Sky Runner • Phaser 3 • © 2025</div>
  <script>
    // Game config
    const W = 960, H = 540;
    const config = {
      type: Phaser.AUTO,
      width: W,
      height: H,
      backgroundColor: '#0b0f1a',
      parent: 'game',
      physics: { default: 'arcade', arcade: { gravity: { y: 1400 }, debug: false } },
      scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);

    // Global refs
    let player, ground, obstacles, stars, cursors, jumpKey, scoreText, bestText, infoText, pauseKey;
    let speed = 360;        // world speed
    let spawnTimer = 0;     // obstacle spawn time accumulator
    let score = 0;          // current score
    let best = +localStorage.getItem('skyRunnerBest') || 0;
    let playing = false;

    function preload() {
      // Generate simple textures programmatically (no external assets)
      this.textures.generate('playerTex', { data: [
        '........',
        '..7777..',
        '.777777.',
        '.77..77.',
        '.777777.',
        '..7777..',
        '...77...',
        '..7777..'
      ], pixelWidth: 6 });

      this.textures.generate('groundTex', { data: [
        '99999999',
        '77777777',
        '55555555'
      ], pixelWidth: 8 });

      this.textures.generate('spikeTex', { data: [
        '...8...',
        '..888..',
        '.88888.',
        '8888888'
      ], pixelWidth: 6 });

      this.textures.generate('starTex', { data: [
        '..0..',
        '.000.',
        '00000',
        '.000.',
        '..0..'
      ], pixelWidth: 3 });
    }

    function create() {
      // Parallax sky (two gradient rectangles drawn with graphics)
      const g = this.add.graphics();
      g.fillStyle(0x12203a, 1).fillRect(0,0,W,H);
      const grad = this.add.graphics();
      grad.fillStyle(0x1a2b4b, 1).fillRect(0, H*0.55, W, H*0.45);

      // Distant moving stars
      stars = this.add.group();
      for (let i=0;i<60;i++) addStar(this, Phaser.Math.Between(0, W), Phaser.Math.Between(0, H*0.6));

      // Ground: a static physics group formed by repeating tiles
      ground = this.physics.add.staticGroup();
      const tileW = 64; const groundY = H - 48;
      for (let x = 0; x < W + tileW; x += tileW) {
        const t = ground.create(x, groundY, 'groundTex').setOrigin(0,0).refreshBody();
      }

      // Player
      player = this.physics.add.sprite(180, groundY - 40, 'playerTex');
      player.setCollideWorldBounds(true);
      player.setBounce(0);
      player.body.setSize(player.width*0.7, player.height*0.9).setOffset(player.width*0.15, player.height*0.1);

      // Simple run animation via tweening scale for squash & stretch
      this.tweens.add({ targets: player, scaleY: 0.96, scaleX: 1.04, yoyo: true, repeat: -1, duration: 160, ease: 'sine.inOut' });

      // Obstacles
      obstacles = this.physics.add.group();

      // UI
      scoreText = this.add.text(20, 16, 'SCORE 0', { fontSize: '28px', fontFamily: 'monospace', color: '#c9e1ff' }).setDepth(10);
      bestText  = this.add.text(20, 50, `BEST ${best}`, { fontSize: '18px', fontFamily: 'monospace', color: '#9bb8e8' }).setDepth(10);
      infoText  = this.add.text(W/2, H/2-40, 'SKY RUNNER\nPress SPACE to start', { fontSize:'32px', fontFamily:'monospace', color:'#d7ecff', align:'center' }).setOrigin(0.5).setDepth(10);
      this.add.text(W-12, H-12, 'Made with Phaser 3', { fontSize:'14px', color:'#6a7ea7' }).setOrigin(1).setAlpha(0.8);

      // Controls
      cursors = this.input.keyboard.createCursorKeys();
      jumpKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);
      pauseKey = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.P);

      // Collisions
      this.physics.add.collider(player, ground);
      this.physics.add.overlap(player, obstacles, () => gameOver(this), null, this);

      // Mobile tap
      this.input.on('pointerdown', () => tryJump());

      // Start on first press
      this.input.keyboard.on('keydown', (e)=>{ if(!playing && (e.code==='Space'||e.code==='ArrowUp'||e.code==='KeyW')) start(this); });
      this.input.on('pointerdown', ()=>{ if(!playing) start(this); });

      // Pause toggle
      pauseKey.on('down', ()=>{ if(playing){ this.scene.isPaused()?this.scene.resume():this.scene.pause(); } });
    }

    function update(time, delta) {
      // Parallax star drift
      stars.children.iterate(s=>{ if(!s) return; s.x -= s.speed * (delta/1000); if (s.x < -10) s.x = W + 10; });

      if (!playing) return;

      spawnTimer += delta;
      // Spawn every 900ms but speed up gradually
      const spawnEvery = Phaser.Math.Clamp(900 - speed*0.6, 420, 900);
      if (spawnTimer > spawnEvery) { spawnTimer = 0; spawnObstacle(this); }

      // Increase speed & score over time
      speed += delta * 0.02; // acceleration
      score += delta * 0.01; // 0.01 pts per ms => ~10 pts/sec
      scoreText.setText('SCORE ' + Math.floor(score));

      // Scroll ground illusion by shifting tiles (cheap parallax)
      ground.getChildren().forEach((t, i)=>{ t.x -= (speed * 0.016); if (t.x <= -t.width) t.x += W + t.width; t.refreshBody(); });

      // Allow variable jump height
      if (Phaser.Input.Keyboard.JustDown(jumpKey) || Phaser.Input.Keyboard.JustDown(cursors.up)) tryJump();
    }

    function start(scene){
      playing = true; speed = 360; score = 0; spawnTimer = 0; infoText.setText('');
      obstacles.clear(true, true);
      player.setPosition(180, H-48-40).setVelocity(0);
    }

    function tryJump(){
      if (!playing) return;
      const onGround = player.body.blocked.down;
      const canDouble = player.getData('canDouble') === true;
      if (onGround) {
        player.setVelocityY(-640);
        player.setData('canDouble', true);
        squash(player);
      } else if (canDouble) {
        player.setVelocityY(-560);
        player.setData('canDouble', false);
        squash(player);
      }
    }

    function squash(target){
      target.scene.tweens.add({ targets: target, scaleY: 0.85, scaleX: 1.1, yoyo: true, duration: 120, ease:'quad.out' });
    }

    function spawnObstacle(scene){
      const kind = Math.random() < 0.75 ? 'spike' : 'pit';
      if (kind === 'spike') {
        const s = obstacles.create(W+40, H-48-20, 'spikeTex');
        s.setVelocityX(-speed);
        s.setImmovable(true);
        s.body.allowGravity = false;
        s.setDepth(5);
      } else {
        // Pit = a gap: disable a few ground tiles briefly by moving a blocker the player can fall into
        // Implement as an invisible sensor that triggers fail if y > threshold
        const sensor = scene.add.rectangle(W+120, H-24, 120, 4, 0xff0000, 0);
        scene.physics.add.existing(sensor, false);
        sensor.body.setVelocityX(-speed);
        sensor.body.allowGravity = false;
        obstacles.add(sensor);
        // When player passes over, check if falling low
        scene.physics.add.overlap(player, sensor, ()=>{
          if (player.y > H-120) gameOver(scene);
        });
      }
      // Clean up off-screen
      obstacles.getChildren().forEach(o=>{ if(o.x < -80){ o.destroy(); } });
    }

    function addStar(scene, x, y){
      const star = scene.add.image(x, y, 'starTex').setAlpha(Phaser.Math.FloatBetween(0.6,1));
      star.speed = Phaser.Math.FloatBetween(20, 80);
      stars.add(star);
    }

    function gameOver(scene){
      if (!playing) return;
      playing = false;
      best = Math.max(best, Math.floor(score));
      localStorage.setItem('skyRunnerBest', best);
      bestText.setText('BEST ' + best);
      scene.time.delayedCall(100, ()=>{
        infoText.setText('GAME OVER\nScore: '+Math.floor(score)+'\nPress SPACE to retry');
      });
      // Small effect
      scene.cameras.main.flash(200, 255, 60, 60);
      scene.tweens.add({ targets: player, angle: 10, yoyo:true, duration: 140 });
    }
  </script>
</body>
</html>
